<style> code { white-space: pre-wrap; display: block; background-color: #eee; }.executed { background-color: #afa; }.reverted { background-color: #ffa; }.unexecuted { background-color: #faa; }.neutral { background-color: #eee; }</style><b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/node_modules/@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol</b>
<code>
  1 |     | <span class='unexecuted'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'>interface AggregatorV3Interface {</span>
  5 |     | <span class='neutral'>  function decimals() external view returns (uint8);</span>
  6 |     | <span class='neutral'></span>
  7 |     | <span class='neutral'>  function description() external view returns (string memory);</span>
  8 |     | <span class='neutral'></span>
  9 |     | <span class='neutral'>  function version() external view returns (uint256);</span>
 10 |     | <span class='neutral'></span>
 11 |     | <span class='neutral'>  function getRoundData(uint80 _roundId)</span>
 12 |     | <span class='neutral'>    external</span>
 13 |     | <span class='neutral'>    view</span>
 14 |     | <span class='neutral'>    returns (</span>
 15 |     | <span class='neutral'>      uint80 roundId,</span>
 16 |     | <span class='neutral'>      int256 answer,</span>
 17 |     | <span class='neutral'>      uint256 startedAt,</span>
 18 |     | <span class='neutral'>      uint256 updatedAt,</span>
 19 |     | <span class='neutral'>      uint80 answeredInRound</span>
 20 |     | <span class='neutral'>    );</span>
 21 |     | <span class='neutral'></span>
 22 |     | <span class='neutral'>  function latestRoundData()</span>
 23 |     | <span class='neutral'>    external</span>
 24 |     | <span class='neutral'>    view</span>
 25 |     | <span class='neutral'>    returns (</span>
 26 |     | <span class='neutral'>      uint80 roundId,</span>
 27 |     | <span class='neutral'>      int256 answer,</span>
 28 |     | <span class='neutral'>      uint256 startedAt,</span>
 29 |     | <span class='neutral'>      uint256 updatedAt,</span>
 30 |     | <span class='neutral'>      uint80 answeredInRound</span>
 31 |     | <span class='neutral'>    );</span>
 32 |     | <span class='neutral'>}</span>
 33 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/node_modules/@openzeppelin/contracts/token/ERC20/IERC20.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span class='neutral'>// OpenZeppelin Contracts (last updated v4.6.0) (token/ERC20/IERC20.sol)</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
  5 |     | <span class='neutral'></span>
  6 |     | <span class='neutral'>/**</span>
  7 |     | <span class='neutral'> * @dev Interface of the ERC20 standard as defined in the EIP.</span>
  8 |     | <span class='neutral'> */</span>
  9 |     | <span class='neutral'>interface IERC20 {</span>
 10 |     | <span class='neutral'>    /**</span>
 11 |     | <span class='unexecuted'>     * @dev Emitted when `value` tokens are moved from one account (`from`) to</span>
 12 |     | <span class='neutral'>     * another (`to`).</span>
 13 |     | <span class='neutral'>     *</span>
 14 |     | <span class='neutral'>     * Note that `value` may be zero.</span>
 15 |     | <span class='neutral'>     */</span>
 16 |     | <span class='unexecuted'>    event Transfer(address indexed from, address indexed to, uint256 value);</span>
 17 |     | <span class='neutral'></span>
 18 |     | <span class='neutral'>    /**</span>
 19 |     | <span class='unexecuted'>     * @dev Emitted when the allowance of a `spender` for an `owner` is set by</span>
 20 |     | <span class='unexecuted'>     * a call to {approve}. `value` is the new allowance.</span>
 21 |     | <span class='unexecuted'>     */</span>
 22 |     | <span class='unexecuted'>    event Approval(address indexed owner, address indexed spender, uint256 value);</span>
 23 |     | <span class='neutral'></span>
 24 |     | <span class='neutral'>    /**</span>
 25 |     | <span class='unexecuted'>     * @dev Returns the amount of tokens in existence.</span>
 26 |     | <span class='neutral'>     */</span>
 27 |     | <span class='unexecuted'>    function totalSupply() external view returns (uint256);</span>
 28 |     | <span class='neutral'></span>
 29 |     | <span class='neutral'>    /**</span>
 30 |     | <span class='neutral'>     * @dev Returns the amount of tokens owned by `account`.</span>
 31 |     | <span class='neutral'>     */</span>
 32 |     | <span class='neutral'>    function balanceOf(address account) external view returns (uint256);</span>
 33 |     | <span class='neutral'></span>
 34 |     | <span class='neutral'>    /**</span>
 35 |     | <span class='neutral'>     * @dev Moves `amount` tokens from the caller&#39;s account to `to`.</span>
 36 |     | <span class='neutral'>     *</span>
 37 |     | <span class='neutral'>     * Returns a boolean value indicating whether the operation succeeded.</span>
 38 |     | <span class='neutral'>     *</span>
 39 |     | <span class='neutral'>     * Emits a {Transfer} event.</span>
 40 |     | <span class='neutral'>     */</span>
 41 |     | <span class='neutral'>    function transfer(address to, uint256 amount) external returns (bool);</span>
 42 |     | <span class='neutral'></span>
 43 |     | <span class='neutral'>    /**</span>
 44 |     | <span class='neutral'>     * @dev Returns the remaining number of tokens that `spender` will be</span>
 45 |     | <span class='neutral'>     * allowed to spend on behalf of `owner` through {transferFrom}. This is</span>
 46 |     | <span class='neutral'>     * zero by default.</span>
 47 |     | <span class='neutral'>     *</span>
 48 |     | <span class='neutral'>     * This value changes when {approve} or {transferFrom} are called.</span>
 49 |     | <span class='neutral'>     */</span>
 50 |     | <span class='neutral'>    function allowance(address owner, address spender) external view returns (uint256);</span>
 51 |     | <span class='neutral'></span>
 52 |     | <span class='neutral'>    /**</span>
 53 |     | <span class='neutral'>     * @dev Sets `amount` as the allowance of `spender` over the caller&#39;s tokens.</span>
 54 |     | <span class='neutral'>     *</span>
 55 |     | <span class='neutral'>     * Returns a boolean value indicating whether the operation succeeded.</span>
 56 |     | <span class='neutral'>     *</span>
 57 |     | <span class='neutral'>     * IMPORTANT: Beware that changing an allowance with this method brings the risk</span>
 58 |     | <span class='neutral'>     * that someone may use both the old and the new allowance by unfortunate</span>
 59 |     | <span class='neutral'>     * transaction ordering. One possible solution to mitigate this race</span>
 60 |     | <span class='neutral'>     * condition is to first reduce the spender&#39;s allowance to 0 and set the</span>
 61 |     | <span class='neutral'>     * desired value afterwards:</span>
 62 |     | <span class='neutral'>     * https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729</span>
 63 |     | <span class='neutral'>     *</span>
 64 |     | <span class='neutral'>     * Emits an {Approval} event.</span>
 65 |     | <span class='neutral'>     */</span>
 66 |     | <span class='neutral'>    function approve(address spender, uint256 amount) external returns (bool);</span>
 67 |     | <span class='neutral'></span>
 68 |     | <span class='neutral'>    /**</span>
 69 |     | <span class='neutral'>     * @dev Moves `amount` tokens from `from` to `to` using the</span>
 70 |     | <span class='neutral'>     * allowance mechanism. `amount` is then deducted from the caller&#39;s</span>
 71 |     | <span class='neutral'>     * allowance.</span>
 72 |     | <span class='neutral'>     *</span>
 73 |     | <span class='neutral'>     * Returns a boolean value indicating whether the operation succeeded.</span>
 74 |     | <span class='neutral'>     *</span>
 75 |     | <span class='neutral'>     * Emits a {Transfer} event.</span>
 76 |     | <span class='neutral'>     */</span>
 77 |     | <span class='neutral'>    function transferFrom(</span>
 78 |     | <span class='neutral'>        address from,</span>
 79 |     | <span class='neutral'>        address to,</span>
 80 |     | <span class='neutral'>        uint256 amount</span>
 81 |     | <span class='neutral'>    ) external returns (bool);</span>
 82 |     | <span class='neutral'>}</span>
 83 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/contracts/AppStorage.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: GPL-2.0-or-later</span>
  2 |     | <span class='neutral'>pragma solidity 0.8.19;</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'></span>
  5 |     | <span class='neutral'>import &quot;@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol&quot;;</span>
  6 |     | <span class='neutral'></span>
  7 |     | <span class='neutral'></span>
  8 |     | <span class='neutral'>struct AppStorage {</span>
  9 |     | <span class='neutral'></span>
 10 |     | <span class='neutral'>    AggregatorV3Interface wtiFeed;</span>
 11 |     | <span class='neutral'>    AggregatorV3Interface volatilityFeed;</span>
 12 |     | <span class='neutral'>    AggregatorV3Interface ethFeed;</span>
 13 |     | <span class='neutral'>    AggregatorV3Interface goldFeed;</span>
 14 |     | <span class='neutral'>}</span>
 15 |     | <span class='neutral'></span>
 16 |     | <span class='neutral'></span>
 17 |     | <span class='neutral'>struct DataInfo {</span>
 18 |     | <span class='unexecuted'>    uint80 roundId;</span>
 19 |     | <span class='neutral'>    int256 value;</span>
 20 |     | <span class='neutral'>}</span>
 21 |     | <span class='neutral'></span>
 22 |     | <span class='neutral'>struct Data {</span>
 23 |     | <span class='neutral'>    DataInfo volIndex;</span>
 24 |     | <span class='unexecuted'>    DataInfo wtiPrice;</span>
 25 |     | <span class='neutral'>    DataInfo ethPrice;</span>
 26 |     | <span class='unexecuted'>    DataInfo goldPrice;</span>
 27 |     | <span class='unexecuted'>}</span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/contracts/InitUpgradeV2.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: GPL-2.0-or-later</span>
  2 |     | <span class='neutral'>pragma solidity 0.8.19;</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'></span>
  5 |     | <span class='unexecuted'>import &quot;@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol&quot;;</span>
  6 |     | <span class='neutral'>import &#39;./AppStorage.sol&#39;;</span>
  7 |     | <span class='unexecuted'>import &#39;../libraries/LibDiamond.sol&#39;;</span>
  8 |     | <span class='unexecuted'>// import &#39;hardhat/console.sol&#39;;</span>
  9 |     | <span class='neutral'></span>
 10 |     | <span class='unexecuted'>contract InitUpgradeV2 {</span>
 11 |     | <span class='neutral'></span>
 12 |     | <span class='neutral'>    AppStorage s;</span>
 13 |     | <span class='neutral'></span>
 14 |     | <span class='unexecuted'>    function init(</span>
 15 |     | <span class='unexecuted'>        address[] calldata feeds_,</span>
 16 |     | <span class='unexecuted'>        address[] memory facets_</span>
 17 |     | <span class='unexecuted'>    ) external {</span>
 18 |     | <span class='neutral'></span>
 19 |     | <span class='unexecuted'>        s.wtiFeed = AggregatorV3Interface(feeds_[0]);</span>
 20 |     | <span class='unexecuted'>        s.volatilityFeed = AggregatorV3Interface(feeds_[1]);</span>
 21 |     | <span class='unexecuted'>        s.ethFeed = AggregatorV3Interface(feeds_[2]);</span>
 22 |     | <span class='unexecuted'>        s.goldFeed = AggregatorV3Interface(feeds_[3]);</span>
 23 |     | <span class='neutral'></span>
 24 |     | <span class='unexecuted'>        // address[] memory facets = new address[](2);</span>
 25 |     | <span class='unexecuted'>        // facets[0] = facets_[0];</span>
 26 |     | <span class='unexecuted'>        // facets[0] = facets_[1];</span>
 27 |     | <span class='neutral'></span>
 28 |     | <span class='unexecuted'>        LibDiamond.setNonRevenueFacets(facets_); //test if anyone cann call setNonRevenueFacets</span>
 29 |     | <span class='neutral'></span>
 30 |     | <span class='unexecuted'>        //--------</span>
 31 |     | <span class='unexecuted'>    </span>
 32 |     | <span class='neutral'></span>
 33 |     | <span class='unexecuted'>    }</span>
 34 |     | <span class='unexecuted'>}</span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/contracts/facets/ozOracleFacet.sol</b>
<code>
   1 |     | <span class='neutral'>// SPDX-License-Identifier: GPL-2.0-or-later</span>
   2 |     | <span class='neutral'>pragma solidity 0.8.19;</span>
   3 |     | <span class='neutral'></span>
   4 |     | <span class='unexecuted'></span>
   5 |     | <span class='unexecuted'>import &quot;@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol&quot;;</span>
   6 |     | <span class='unexecuted'>import &#39;../AppStorage.sol&#39;;</span>
   7 |     | <span class='unexecuted'>// import &quot;forge-std/console.sol&quot;;</span>
   8 |     | <span class='neutral'></span>
   9 |     | <span class='unexecuted'>// import &#39;hardhat/console.sol&#39;;</span>
  10 |     | <span class='neutral'></span>
  11 |     | <span class='unexecuted'>//add modularity to add and remove chainlink feeds</span>
  12 |     | <span class='unexecuted'>//add uniswap and trellors oracles as a fallbac</span>
  13 |     | <span class='unexecuted'>contract ozOracleFacet {</span>
  14 |     | <span class='unexecuted'></span>
  15 |     | <span class='neutral'>    AppStorage s;</span>
  16 |     | <span class='neutral'></span>
  17 |     | <span class='unexecuted'>    int256 private constant EIGHT_DEC = 1e8;</span>
  18 |     | <span class='unexecuted'>    int256 private constant NINETN_DEC = 1e19;</span>
  19 |     | <span class='neutral'></span>
  20 |     | <span class='unexecuted'>    int constant BASE = 1e7;</span>
  21 |     | <span class='neutral'></span>
  22 |     | <span class='neutral'></span>
  23 |     | <span class='neutral'></span>
  24 |     | <span class='unexecuted'>    //**** MAIN ******/</span>
  25 |     | <span class='neutral'></span>
  26 |     | <span class='unexecuted'>    function getLastPrice() external view returns(uint256) {</span>
  27 |     | <span class='unexecuted'>        (Data memory data, int basePrice) = _getDataFeeds();</span>
  28 |     | <span class='unexecuted'>        int256 volIndex = data.volIndex.value;</span>
  29 |     | <span class='neutral'></span>
  30 |     | <span class='unexecuted'>        int256 implWti = _setPrice(data.wtiPrice, volIndex, s.wtiFeed); </span>
  31 |     | <span class='unexecuted'>        int256 implGold = _setPrice(data.goldPrice, volIndex, s.goldFeed);</span>
  32 |     | <span class='unexecuted'>        int256 implEth = _setPrice(data.ethPrice, 0, s.ethFeed);</span>
  33 |     | <span class='neutral'></span>
  34 |     | <span class='unexecuted'>        int256 netDiff = implWti + implEth + implGold;</span>
  35 |     | <span class='neutral'></span>
  36 |     | <span class='unexecuted'>        return uint256(basePrice + ( (netDiff * basePrice) / (100 * EIGHT_DEC) ));</span>
  37 |     | <span class='unexecuted'>    }</span>
  38 |     | <span class='unexecuted'></span>
  39 |     | <span class='unexecuted'>    //------------------</span>
  40 |     | <span class='neutral'></span>
  41 |     | <span class='unexecuted'>    function getNum() external pure returns(uint) {</span>
  42 |     | <span class='neutral'>        return 3;</span>
  43 |     | <span class='unexecuted'>    }</span>
  44 |     | <span class='neutral'></span>
  45 |     | <span class='neutral'></span>
  46 |     | <span class='unexecuted'>    function _getDataFeeds() private view returns(Data memory data, int basePrice) {</span>
  47 |     | <span class='unexecuted'>        (,int256 volatility,,,) = s.volatilityFeed.latestRoundData();</span>
  48 |     | <span class='unexecuted'>        (uint80 wtiId, int256 wtiPrice,,,) = s.wtiFeed.latestRoundData();</span>
  49 |     | <span class='unexecuted'>        (uint80 ethId, int256 ethPrice,,,) = s.ethFeed.latestRoundData();</span>
  50 |     | <span class='neutral'>        (uint80 goldId, int256 goldPrice,,,) = s.goldFeed.latestRoundData();</span>
  51 |     | <span class='neutral'></span>
  52 |     | <span class='neutral'>        basePrice = _calculateBasePrice(ethPrice);</span>
  53 |     | <span class='neutral'></span>
  54 |     | <span class='neutral'>        data = Data({</span>
  55 |     | <span class='neutral'>            volIndex: DataInfo({</span>
  56 |     | <span class='neutral'>                roundId: 0,</span>
  57 |     | <span class='neutral'>                value: volatility</span>
  58 |     | <span class='neutral'>            }),</span>
  59 |     | <span class='neutral'>            wtiPrice: DataInfo({</span>
  60 |     | <span class='neutral'>                roundId: wtiId,</span>
  61 |     | <span class='neutral'>                value: wtiPrice</span>
  62 |     | <span class='neutral'>            }),</span>
  63 |     | <span class='neutral'>            ethPrice: DataInfo({</span>
  64 |     | <span class='neutral'>                roundId: ethId,</span>
  65 |     | <span class='neutral'>                value: ethPrice</span>
  66 |     | <span class='neutral'>            }),</span>
  67 |     | <span class='neutral'>            goldPrice: DataInfo({</span>
  68 |     | <span class='neutral'>                roundId: goldId,</span>
  69 |     | <span class='neutral'>                value: goldPrice</span>
  70 |     | <span class='neutral'>            })</span>
  71 |     | <span class='neutral'>        });</span>
  72 |     | <span class='neutral'>    }</span>
  73 |     | <span class='neutral'></span>
  74 |     | <span class='neutral'></span>
  75 |     | <span class='neutral'>     function _getPrevFeed(</span>
  76 |     | <span class='neutral'>        uint80 roundId_, </span>
  77 |     | <span class='neutral'>        AggregatorV3Interface feed_</span>
  78 |     | <span class='neutral'>    ) private view returns(int256) {</span>
  79 |     | <span class='neutral'>        (,int256 prevPrice,,,) = feed_.getRoundData(roundId_ - 1);</span>
  80 |     | <span class='neutral'>        return prevPrice;</span>
  81 |     | <span class='neutral'>    }</span>
  82 |     | <span class='neutral'></span>
  83 |     | <span class='neutral'>    function _setPrice(</span>
  84 |     | <span class='neutral'>        DataInfo memory price_, </span>
  85 |     | <span class='neutral'>        int256 volIndex_, </span>
  86 |     | <span class='neutral'>        AggregatorV3Interface feed_</span>
  87 |     | <span class='neutral'>    ) private view returns(int256) {</span>
  88 |     | <span class='neutral'>        if (address(feed_) != address(s.ethFeed)) {</span>
  89 |     | <span class='neutral'>            int256 currPrice = price_.value;</span>
  90 |     | <span class='neutral'>            int256 netDiff = currPrice - _getPrevFeed(price_.roundId, feed_);</span>
  91 |     | <span class='neutral'>            return ( (netDiff * 100 * EIGHT_DEC) / currPrice ) * (volIndex_ / NINETN_DEC);</span>
  92 |     | <span class='neutral'>        } else {</span>
  93 |     | <span class='neutral'>            int256 prevEthPrice = _getPrevFeed(price_.roundId, feed_);</span>
  94 |     | <span class='neutral'>            int256 netDiff = price_.value - prevEthPrice;</span>
  95 |     | <span class='neutral'>            return (netDiff * 100 * EIGHT_DEC) / prevEthPrice;</span>
  96 |     | <span class='neutral'>        }</span>
  97 |     | <span class='neutral'>    }</span>
  98 |     | <span class='neutral'></span>
  99 |     | <span class='neutral'>    function _calculateBasePrice(int256 ethPrice_) private pure returns(int256) {</span>
 100 |     | <span class='neutral'>        return ( (100 * EIGHT_DEC * ethPrice_) / 10 * EIGHT_DEC ) / BASE;</span>
 101 |     | <span class='neutral'>    }</span>
 102 |     | <span class='neutral'>    </span>
 103 |     | <span class='neutral'></span>
 104 |     | <span class='neutral'>}</span>
 105 |     | <span class='neutral'></span>
 106 |     | <span class='neutral'></span>
 107 |     | <span class='neutral'></span>
 108 |     | <span class='neutral'></span>
 109 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/contracts/testing-files/EthFeed.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: GPL-2.0-or-later</span>
  2 |     | <span class='neutral'>pragma solidity 0.8.19;</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='unexecuted'>// import &quot;forge-std/console.sol&quot;;</span>
  5 |     | <span class='neutral'></span>
  6 |     | <span class='neutral'>contract EthFeed {</span>
  7 |     | <span class='neutral'></span>
  8 |     | <span class='unexecuted'>    function latestRoundData() external view returns(int, int, int, int, int) {</span>
  9 |     | <span class='unexecuted'>        uint blockNum = block.number;</span>
 10 |     | <span class='unexecuted'>        int result;</span>
 11 |     | <span class='neutral'></span>
 12 |     | <span class='neutral'>        assembly {</span>
 13 |     | <span class='neutral'>            switch blockNum </span>
 14 |     | <span class='unexecuted'>            case 69254399 { result := 154700260000 } </span>
 15 |     | <span class='unexecuted'>            case 69255699 { result := 158142799097 } </span>
 16 |     | <span class='unexecuted'>            case 69260699 { result := 158956580000 } </span>
 17 |     | <span class='unexecuted'>            case 69294699 { result := 161684899390 } </span>
 18 |     | <span class='unexecuted'>            case 69295699 { result := 161691000000 } </span>
 19 |     | <span class='unexecuted'>            case 69297699 { result := 161566898000 } </span>
 20 |     | <span class='unexecuted'>            case 69380699 { result := 160800635124 } </span>
 21 |     | <span class='unexecuted'>            case 69421699 { result := 158595420000 } </span>
 22 |     | <span class='unexecuted'>        }</span>
 23 |     | <span class='neutral'></span>
 24 |     | <span class='unexecuted'>        return (1,result,0,0,0);</span>
 25 |     | <span class='unexecuted'>    }</span>
 26 |     | <span class='neutral'></span>
 27 |     | <span class='unexecuted'>    function getRoundData(uint80 roundId_) external view returns(int, int, int, int, int) {</span>
 28 |     | <span class='unexecuted'>        uint blockNum = block.number;</span>
 29 |     | <span class='unexecuted'>        int result = int(uint(roundId_) - uint(roundId_));</span>
 30 |     | <span class='unexecuted'></span>
 31 |     | <span class='unexecuted'>        assembly {</span>
 32 |     | <span class='neutral'>            switch blockNum </span>
 33 |     | <span class='unexecuted'>            case 69254399 { result := 158142799097 }</span>
 34 |     | <span class='unexecuted'>            case 69255699 { result := 158956580000 }</span>
 35 |     | <span class='unexecuted'>            case 69260699 { result := 161684899390 }</span>
 36 |     | <span class='unexecuted'>            case 69294699 { result := 161691000000 }</span>
 37 |     | <span class='unexecuted'>            case 69295699 { result := 161566898000 }</span>
 38 |     | <span class='unexecuted'>            case 69297699 { result := 160800635124 }</span>
 39 |     | <span class='unexecuted'>            case 69380699 { result := 158595420000 }</span>
 40 |     | <span class='unexecuted'>            case 69421699 { result := 154700260000 }</span>
 41 |     | <span class='unexecuted'>        }</span>
 42 |     | <span class='neutral'></span>
 43 |     | <span class='unexecuted'>        return (0,result,0,0,0);</span>
 44 |     | <span class='unexecuted'>    }</span>
 45 |     | <span class='unexecuted'>}</span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/contracts/testing-files/GoldFeed.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: GPL-2.0-or-later</span>
  2 |     | <span class='neutral'>pragma solidity 0.8.19;</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'></span>
  5 |     | <span class='neutral'>contract GoldFeed {</span>
  6 |     | <span class='neutral'></span>
  7 |     | <span class='neutral'>    function latestRoundData() external view returns(int, int, int, int, int) {</span>
  8 |     | <span class='neutral'>        uint blockNum = block.number;</span>
  9 |     | <span class='neutral'>        int result;</span>
 10 |     | <span class='neutral'></span>
 11 |     | <span class='neutral'>        assembly {</span>
 12 |     | <span class='neutral'>            switch blockNum </span>
 13 |     | <span class='neutral'>            case 69254399 { result := 188117000000 } </span>
 14 |     | <span class='neutral'>            case 69255699 { result := 189157000000 } </span>
 15 |     | <span class='neutral'>            case 69260699 { result := 189157000000 } </span>
 16 |     | <span class='neutral'>            case 69294699 { result := 188161500000 } </span>
 17 |     | <span class='neutral'>            case 69295699 { result := 188161500000 } </span>
 18 |     | <span class='neutral'>            case 69297699 { result := 188161500000 } </span>
 19 |     | <span class='neutral'>            case 69380699 { result := 187211000000 } </span>
 20 |     | <span class='neutral'>            case 69421699 { result := 188220158450 } </span>
 21 |     | <span class='neutral'>        }</span>
 22 |     | <span class='neutral'></span>
 23 |     | <span class='neutral'>        return (1,result,0,0,0);</span>
 24 |     | <span class='neutral'>    }</span>
 25 |     | <span class='neutral'></span>
 26 |     | <span class='neutral'>    function getRoundData(uint80 roundId_) external view returns(int, int, int, int, int) {</span>
 27 |     | <span class='neutral'>        uint blockNum = block.number;</span>
 28 |     | <span class='neutral'>        int result = int(uint(roundId_) - uint(roundId_));</span>
 29 |     | <span class='neutral'></span>
 30 |     | <span class='neutral'>        assembly {</span>
 31 |     | <span class='neutral'>            switch blockNum </span>
 32 |     | <span class='neutral'>            case 69254399 { result := 188917000000 }</span>
 33 |     | <span class='neutral'>            case 69255699 { result := 190157000000 }</span>
 34 |     | <span class='neutral'>            case 69260699 { result := 186757000000 }</span>
 35 |     | <span class='neutral'>            case 69294699 { result := 187261500000 }</span>
 36 |     | <span class='neutral'>            case 69295699 { result := 191261500000 }</span>
 37 |     | <span class='neutral'>            case 69297699 { result := 187161500000 }</span>
 38 |     | <span class='neutral'>            case 69380699 { result := 186011000000 }</span>
 39 |     | <span class='neutral'>            case 69421699 { result := 185720158450 }</span>
 40 |     | <span class='neutral'>        }</span>
 41 |     | <span class='neutral'></span>
 42 |     | <span class='neutral'>        return (0,result,0,0,0);</span>
 43 |     | <span class='neutral'>    }</span>
 44 |     | <span class='neutral'>}</span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/contracts/testing-files/WtiFeed.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: GPL-2.0-or-later</span>
  2 |     | <span class='neutral'>pragma solidity 0.8.19;</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'>// import &#39;hardhat/console.sol&#39;;</span>
  5 |     | <span class='neutral'></span>
  6 |     | <span class='neutral'>contract WtiFeed {</span>
  7 |     | <span class='neutral'></span>
  8 |     | <span class='neutral'>    function latestRoundData() external view returns(int, int, int, int, int) {</span>
  9 |     | <span class='neutral'>        uint blockNum = block.number;</span>
 10 |     | <span class='neutral'>        int result;</span>
 11 |     | <span class='neutral'></span>
 12 |     | <span class='neutral'>        // console.log(&#39;myBlock: &#39;, blockNum);</span>
 13 |     | <span class='neutral'></span>
 14 |     | <span class='neutral'>        assembly {</span>
 15 |     | <span class='neutral'>            switch blockNum </span>
 16 |     | <span class='neutral'>            case 69254399 { result := 7632500000 } </span>
 17 |     | <span class='neutral'>            case 69255699 { result := 7672000000 } </span>
 18 |     | <span class='neutral'>            case 69260699 { result := 7717200000 } </span>
 19 |     | <span class='neutral'>            case 69294699 { result := 7677600000 } </span>
 20 |     | <span class='neutral'>            case 69295699 { result := 7704200000 } </span>
 21 |     | <span class='neutral'>            case 69297699 { result := 7639200000 } </span>
 22 |     | <span class='neutral'>            case 69380699 { result := 7674920000 } </span>
 23 |     | <span class='neutral'>            case 69421699 { result := 7592500000 } </span>
 24 |     | <span class='neutral'>        }</span>
 25 |     | <span class='neutral'></span>
 26 |     | <span class='neutral'>        return (1,result,0,0,0);</span>
 27 |     | <span class='neutral'>    }</span>
 28 |     | <span class='neutral'></span>
 29 |     | <span class='neutral'>    function getRoundData(uint80 roundId_) external view returns(int, int, int, int, int) {</span>
 30 |     | <span class='neutral'>        uint blockNum = block.number;</span>
 31 |     | <span class='neutral'>        int result = int(uint(roundId_) - uint(roundId_));</span>
 32 |     | <span class='neutral'></span>
 33 |     | <span class='neutral'>        assembly {</span>
 34 |     | <span class='neutral'>            switch blockNum </span>
 35 |     | <span class='neutral'>            case 69254399 { result := 7672000000 }</span>
 36 |     | <span class='neutral'>            case 69255699 { result := 7717200000 }</span>
 37 |     | <span class='neutral'>            case 69260699 { result := 7677600000 }</span>
 38 |     | <span class='neutral'>            case 69294699 { result := 7704200000 }</span>
 39 |     | <span class='neutral'>            case 69295699 { result := 7639200000 }</span>
 40 |     | <span class='neutral'>            case 69297699 { result := 7674920000 }</span>
 41 |     | <span class='neutral'>            case 69380699 { result := 7592500000 }</span>
 42 |     | <span class='neutral'>            case 69421699 { result := 7632500000 }</span>
 43 |     | <span class='neutral'>        }</span>
 44 |     | <span class='neutral'></span>
 45 |     | <span class='neutral'>        return (0,result,0,0,0);</span>
 46 |     | <span class='neutral'>    }</span>
 47 |     | <span class='neutral'>}</span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/interfaces/IDiamondCut.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'>/******************************************************************************\</span>
  5 |     | <span class='neutral'>* Author: Nick Mudge &lt;nick@perfectabstractions.com&gt; (https://twitter.com/mudgen)</span>
  6 |     | <span class='neutral'>* EIP-2535 Diamonds: https://eips.ethereum.org/EIPS/eip-2535</span>
  7 |     | <span class='neutral'>/******************************************************************************/</span>
  8 |     | <span class='neutral'></span>
  9 |     | <span class='neutral'>interface IDiamondCut {</span>
 10 |     | <span class='neutral'>    enum FacetCutAction {Add, Replace, Remove}</span>
 11 |     | <span class='neutral'>    // Add=0, Replace=1, Remove=2</span>
 12 |     | <span class='neutral'></span>
 13 |     | <span class='unexecuted'>    struct FacetCut {</span>
 14 |     | <span class='neutral'>        address facetAddress;</span>
 15 |     | <span class='unexecuted'>        FacetCutAction action;</span>
 16 |     | <span class='neutral'>        bytes4[] functionSelectors;</span>
 17 |     | <span class='neutral'>    }</span>
 18 |     | <span class='neutral'></span>
 19 |     | <span class='neutral'>    /// @notice Add/replace/remove any number of functions and optionally execute</span>
 20 |     | <span class='neutral'>    ///         a function with delegatecall</span>
 21 |     | <span class='neutral'>    /// @param _diamondCut Contains the facet addresses and function selectors</span>
 22 |     | <span class='neutral'>    /// @param _init The address of the contract or facet to execute _calldata</span>
 23 |     | <span class='neutral'>    /// @param _calldata A function call, including function selector and arguments</span>
 24 |     | <span class='neutral'>    ///                  _calldata is executed with delegatecall on _init</span>
 25 |     | <span class='neutral'>    function diamondCut(</span>
 26 |     | <span class='neutral'>        FacetCut[] calldata _diamondCut,</span>
 27 |     | <span class='neutral'>        address _init,</span>
 28 |     | <span class='neutral'>        bytes calldata _calldata</span>
 29 |     | <span class='neutral'>    ) external;</span>
 30 |     | <span class='neutral'></span>
 31 |     | <span class='neutral'>    event DiamondCut(FacetCut[] _diamondCut, address _init, bytes _calldata);</span>
 32 |     | <span class='neutral'>}</span>
 33 |     | <span class='unexecuted'></span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/interfaces/ozIDiamond.sol</b>
<code>
  1 |     | <span class='neutral'>pragma solidity 0.8.19;</span>
  2 |     | <span class='neutral'></span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'></span>
  5 |     | <span class='neutral'></span>
  6 |     | <span class='neutral'>interface ozIDiamond {</span>
  7 |     | <span class='neutral'></span>
  8 |     | <span class='neutral'>    struct FacetCut {</span>
  9 |     | <span class='neutral'>        address facetAddress;</span>
 10 |     | <span class='neutral'>        FacetCutAction action;</span>
 11 |     | <span class='neutral'>        bytes4[] functionSelectors;</span>
 12 |     | <span class='neutral'>    }</span>
 13 |     | <span class='neutral'></span>
 14 |     | <span class='neutral'>    enum FacetCutAction {Add, Replace, Remove}</span>
 15 |     | <span class='neutral'></span>
 16 |     | <span class='neutral'>    function diamondCut(FacetCut[] memory _diamondCut, address _init, bytes memory _calldata) external;</span>
 17 |     | <span class='neutral'>    function getLastPrice() external view returns(uint256);</span>
 18 |     | <span class='neutral'>    function getEnergyPrice() external view returns(uint256);</span>
 19 |     | <span class='neutral'>    function getOzelIndex() external view returns(uint256);</span>
 20 |     | <span class='neutral'></span>
 21 |     | <span class='neutral'>}</span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/libraries/LibDiamond.sol</b>
<code>
   1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
   2 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
   3 |     | <span class='neutral'></span>
   4 |     | <span class='neutral'>/******************************************************************************\</span>
   5 |     | <span class='neutral'>* Author: Nick Mudge &lt;nick@perfectabstractions.com&gt; (https://twitter.com/mudgen)</span>
   6 |     | <span class='neutral'>* EIP-2535 Diamonds: https://eips.ethereum.org/EIPS/eip-2535</span>
   7 |     | <span class='neutral'>/******************************************************************************/</span>
   8 |     | <span class='neutral'>import { IDiamondCut } from &quot;../interfaces/IDiamondCut.sol&quot;;</span>
   9 |     | <span class='neutral'>import &#39;@openzeppelin/contracts/token/ERC20/IERC20.sol&#39;;</span>
  10 |     | <span class='neutral'></span>
  11 |     | <span class='neutral'></span>
  12 |     | <span class='neutral'>library LibDiamond {</span>
  13 |     | <span class='neutral'>    bytes32 constant DIAMOND_STORAGE_POSITION = keccak256(&quot;diamond.standard.diamond.storage&quot;);</span>
  14 |     | <span class='neutral'></span>
  15 |     | <span class='neutral'>    struct FacetAddressAndPosition {</span>
  16 |     | <span class='neutral'>        address facetAddress;</span>
  17 |     | <span class='neutral'>        uint96 functionSelectorPosition; // position in facetFunctionSelectors.functionSelectors array</span>
  18 |     | <span class='neutral'>    }</span>
  19 |     | <span class='neutral'></span>
  20 |     | <span class='neutral'>    struct FacetFunctionSelectors {</span>
  21 |     | <span class='neutral'>        bytes4[] functionSelectors;</span>
  22 |     | <span class='neutral'>        uint256 facetAddressPosition; // position of facetAddress in facetAddresses array</span>
  23 |     | <span class='neutral'>    }</span>
  24 |     | <span class='neutral'></span>
  25 |     | <span class='neutral'>    struct Facets {</span>
  26 |     | <span class='neutral'>        bytes4[][] selectors;</span>
  27 |     | <span class='neutral'>        address[] addresses;</span>
  28 |     | <span class='neutral'>    }</span>
  29 |     | <span class='neutral'></span>
  30 |     | <span class='neutral'>    struct Token {</span>
  31 |     | <span class='neutral'>        address l1Address;</span>
  32 |     | <span class='neutral'>        address l2Address;</span>
  33 |     | <span class='neutral'>    }</span>
  34 |     | <span class='neutral'></span>
  35 |     | <span class='neutral'>    struct VarsAndAddresses { </span>
  36 |     | <span class='neutral'>        address[] contracts;</span>
  37 |     | <span class='neutral'>        address[] erc20s;</span>
  38 |     | <span class='neutral'>        Token[] tokensDb;</span>
  39 |     | <span class='neutral'>        address ETH;</span>
  40 |     | <span class='neutral'>        uint[] appVars;</span>
  41 |     | <span class='neutral'>        uint[] revenueAmounts;</span>
  42 |     | <span class='neutral'>        string[] ozlVars;</span>
  43 |     | <span class='neutral'>    }</span>
  44 |     | <span class='neutral'></span>
  45 |     | <span class='neutral'></span>
  46 |     | <span class='neutral'>    struct DiamondStorage {</span>
  47 |     | <span class='neutral'>        // maps function selector to the facet address and</span>
  48 |     | <span class='neutral'>        // the position of the selector in the facetFunctionSelectors.selectors array</span>
  49 |     | <span class='neutral'>        mapping(bytes4 =&gt; FacetAddressAndPosition) selectorToFacetAndPosition;</span>
  50 |     | <span class='neutral'>        // // maps facet addresses to function selectors</span>
  51 |     | <span class='neutral'>        mapping(address =&gt; FacetFunctionSelectors) facetFunctionSelectors;</span>
  52 |     | <span class='neutral'>        // facet addresses</span>
  53 |     | <span class='neutral'>        address[] facetAddresses;</span>
  54 |     | <span class='neutral'>        // Used to query if a contract implements an interface.</span>
  55 |     | <span class='neutral'>        // Used to implement ERC-165.</span>
  56 |     | <span class='neutral'>        mapping(bytes4 =&gt; bool) supportedInterfaces;</span>
  57 |     | <span class='neutral'>        // owner of the contract</span>
  58 |     | <span class='neutral'>        address contractOwner; </span>
  59 |     | <span class='neutral'>        //facets that don&#39;t check revenue</span>
  60 |     | <span class='neutral'>        address[] nonRevenueFacets;</span>
  61 |     | <span class='neutral'>    }</span>
  62 |     | <span class='neutral'></span>
  63 |     | <span class='neutral'>    function diamondStorage() internal pure returns (DiamondStorage storage ds) {</span>
  64 |     | <span class='neutral'>        bytes32 position = DIAMOND_STORAGE_POSITION;</span>
  65 |     | <span class='neutral'>        assembly {</span>
  66 |     | <span class='neutral'>            ds.slot := position</span>
  67 |     | <span class='neutral'>        }</span>
  68 |     | <span class='neutral'>    }</span>
  69 |     | <span class='neutral'></span>
  70 |     | <span class='neutral'>    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span>
  71 |     | <span class='neutral'></span>
  72 |     | <span class='neutral'>    function setContractOwner(address _newOwner) internal {</span>
  73 |     | <span class='neutral'>        DiamondStorage storage ds = diamondStorage();</span>
  74 |     | <span class='neutral'>        address previousOwner = ds.contractOwner;</span>
  75 |     | <span class='neutral'>        ds.contractOwner = _newOwner;</span>
  76 |     | <span class='neutral'>        emit OwnershipTransferred(previousOwner, _newOwner);</span>
  77 |     | <span class='neutral'>    }</span>
  78 |     | <span class='neutral'></span>
  79 |     | <span class='neutral'>    function contractOwner() internal view returns (address contractOwner_) {</span>
  80 |     | <span class='neutral'>        contractOwner_ = diamondStorage().contractOwner;</span>
  81 |     | <span class='neutral'>    }</span>
  82 |     | <span class='neutral'></span>
  83 |     | <span class='neutral'>    function enforceIsContractOwner() internal view {</span>
  84 |     | <span class='neutral'>        require(msg.sender == diamondStorage().contractOwner, &quot;LibDiamond: Must be contract owner&quot;);</span>
  85 |     | <span class='neutral'>    }</span>
  86 |     | <span class='neutral'></span>
  87 |     | <span class='neutral'>    event DiamondCut(IDiamondCut.FacetCut[] _diamondCut, address _init, bytes _calldata);</span>
  88 |     | <span class='neutral'></span>
  89 |     | <span class='neutral'>    // Internal function version of diamondCut</span>
  90 |     | <span class='neutral'>    function diamondCut(</span>
  91 |     | <span class='neutral'>        IDiamondCut.FacetCut[] memory _diamondCut,</span>
  92 |     | <span class='neutral'>        address _init,</span>
  93 |     | <span class='neutral'>        bytes memory _calldata</span>
  94 |     | <span class='neutral'>    ) internal {</span>
  95 |     | <span class='neutral'>        for (uint256 facetIndex; facetIndex &lt; _diamondCut.length; facetIndex++) {</span>
  96 |     | <span class='neutral'>            IDiamondCut.FacetCutAction action = _diamondCut[facetIndex].action;</span>
  97 |     | <span class='neutral'>            if (action == IDiamondCut.FacetCutAction.Add) {</span>
  98 |     | <span class='neutral'>                addFunctions(_diamondCut[facetIndex].facetAddress, _diamondCut[facetIndex].functionSelectors);</span>
  99 |     | <span class='neutral'>            } else if (action == IDiamondCut.FacetCutAction.Replace) {</span>
 100 |     | <span class='neutral'>                replaceFunctions(_diamondCut[facetIndex].facetAddress, _diamondCut[facetIndex].functionSelectors);</span>
 101 |     | <span class='neutral'>            } else if (action == IDiamondCut.FacetCutAction.Remove) {</span>
 102 |     | <span class='neutral'>                removeFunctions(_diamondCut[facetIndex].facetAddress, _diamondCut[facetIndex].functionSelectors);</span>
 103 |     | <span class='neutral'>            } else {</span>
 104 |     | <span class='neutral'>                revert(&quot;LibDiamondCut: Incorrect FacetCutAction&quot;);</span>
 105 |     | <span class='neutral'>            }</span>
 106 |     | <span class='neutral'>        }</span>
 107 |     | <span class='neutral'>        emit DiamondCut(_diamondCut, _init, _calldata);</span>
 108 |     | <span class='neutral'>        initializeDiamondCut(_init, _calldata);</span>
 109 |     | <span class='neutral'>    }</span>
 110 |     | <span class='neutral'></span>
 111 |     | <span class='neutral'>    function addFunctions(address _facetAddress, bytes4[] memory _functionSelectors) internal {</span>
 112 |     | <span class='neutral'>        require(_functionSelectors.length &gt; 0, &quot;LibDiamondCut: No selectors in facet to cut&quot;);</span>
 113 |     | <span class='neutral'>        DiamondStorage storage ds = diamondStorage();        </span>
 114 |     | <span class='neutral'>        require(_facetAddress != address(0), &quot;LibDiamondCut: Add facet can&#39;t be address(0)&quot;);</span>
 115 |     | <span class='neutral'>        uint96 selectorPosition = uint96(ds.facetFunctionSelectors[_facetAddress].functionSelectors.length);</span>
 116 |     | <span class='neutral'>        // add new facet address if it does not exist</span>
 117 |     | <span class='neutral'>        if (selectorPosition == 0) {</span>
 118 |     | <span class='neutral'>            addFacet(ds, _facetAddress);            </span>
 119 |     | <span class='neutral'>        }</span>
 120 |     | <span class='neutral'>        for (uint256 selectorIndex; selectorIndex &lt; _functionSelectors.length; selectorIndex++) {</span>
 121 |     | <span class='neutral'>            bytes4 selector = _functionSelectors[selectorIndex];</span>
 122 |     | <span class='neutral'>            address oldFacetAddress = ds.selectorToFacetAndPosition[selector].facetAddress;</span>
 123 |     | <span class='neutral'>            require(oldFacetAddress == address(0), &quot;LibDiamondCut: Can&#39;t add function that already exists&quot;);</span>
 124 |     | <span class='neutral'>            addFunction(ds, selector, selectorPosition, _facetAddress);</span>
 125 |     | <span class='neutral'>            selectorPosition++;</span>
 126 |     | <span class='neutral'>        }</span>
 127 |     | <span class='neutral'>    }</span>
 128 |     | <span class='neutral'></span>
 129 |     | <span class='neutral'>    function replaceFunctions(address _facetAddress, bytes4[] memory _functionSelectors) internal {</span>
 130 |     | <span class='neutral'>        require(_functionSelectors.length &gt; 0, &quot;LibDiamondCut: No selectors in facet to cut&quot;);</span>
 131 |     | <span class='neutral'>        DiamondStorage storage ds = diamondStorage();</span>
 132 |     | <span class='neutral'>        require(_facetAddress != address(0), &quot;LibDiamondCut: Add facet can&#39;t be address(0)&quot;);</span>
 133 |     | <span class='neutral'>        uint96 selectorPosition = uint96(ds.facetFunctionSelectors[_facetAddress].functionSelectors.length);</span>
 134 |     | <span class='neutral'>        // add new facet address if it does not exist</span>
 135 |     | <span class='neutral'>        if (selectorPosition == 0) {</span>
 136 |     | <span class='neutral'>            addFacet(ds, _facetAddress);</span>
 137 |     | <span class='neutral'>        }</span>
 138 |     | <span class='neutral'>        for (uint256 selectorIndex; selectorIndex &lt; _functionSelectors.length; selectorIndex++) {</span>
 139 |     | <span class='neutral'>            bytes4 selector = _functionSelectors[selectorIndex];</span>
 140 |     | <span class='neutral'>            address oldFacetAddress = ds.selectorToFacetAndPosition[selector].facetAddress;</span>
 141 |     | <span class='neutral'>            require(oldFacetAddress != _facetAddress, &quot;LibDiamondCut: Can&#39;t replace function with same function&quot;);</span>
 142 |     | <span class='neutral'>            removeFunction(ds, oldFacetAddress, selector);</span>
 143 |     | <span class='neutral'>            addFunction(ds, selector, selectorPosition, _facetAddress);</span>
 144 |     | <span class='neutral'>            selectorPosition++;</span>
 145 |     | <span class='neutral'>        }</span>
 146 |     | <span class='neutral'>    }</span>
 147 |     | <span class='neutral'></span>
 148 |     | <span class='neutral'>    function removeFunctions(address _facetAddress, bytes4[] memory _functionSelectors) internal {</span>
 149 |     | <span class='neutral'>        require(_functionSelectors.length &gt; 0, &quot;LibDiamondCut: No selectors in facet to cut&quot;);</span>
 150 |     | <span class='neutral'>        DiamondStorage storage ds = diamondStorage();</span>
 151 |     | <span class='neutral'>        // if function does not exist then do nothing and return</span>
 152 |     | <span class='neutral'>        require(_facetAddress == address(0), &quot;LibDiamondCut: Remove facet address must be address(0)&quot;);</span>
 153 |     | <span class='neutral'>        for (uint256 selectorIndex; selectorIndex &lt; _functionSelectors.length; selectorIndex++) {</span>
 154 |     | <span class='neutral'>            bytes4 selector = _functionSelectors[selectorIndex];</span>
 155 |     | <span class='neutral'>            address oldFacetAddress = ds.selectorToFacetAndPosition[selector].facetAddress;</span>
 156 |     | <span class='neutral'>            removeFunction(ds, oldFacetAddress, selector);</span>
 157 |     | <span class='neutral'>        }</span>
 158 |     | <span class='neutral'>    }</span>
 159 |     | <span class='neutral'></span>
 160 |     | <span class='neutral'>    function addFacet(DiamondStorage storage ds, address _facetAddress) internal {</span>
 161 |     | <span class='neutral'>        enforceHasContractCode(_facetAddress, &quot;LibDiamondCut: New facet has no code&quot;);</span>
 162 |     | <span class='neutral'>        ds.facetFunctionSelectors[_facetAddress].facetAddressPosition = ds.facetAddresses.length;</span>
 163 |     | <span class='neutral'>        ds.facetAddresses.push(_facetAddress);</span>
 164 |     | <span class='neutral'>    }    </span>
 165 |     | <span class='neutral'></span>
 166 |     | <span class='neutral'></span>
 167 |     | <span class='neutral'>    function addFunction(DiamondStorage storage ds, bytes4 _selector, uint96 _selectorPosition, address _facetAddress) internal {</span>
 168 |     | <span class='neutral'>        ds.selectorToFacetAndPosition[_selector].functionSelectorPosition = _selectorPosition;</span>
 169 |     | <span class='neutral'>        ds.facetFunctionSelectors[_facetAddress].functionSelectors.push(_selector);</span>
 170 |     | <span class='neutral'>        ds.selectorToFacetAndPosition[_selector].facetAddress = _facetAddress;</span>
 171 |     | <span class='neutral'>    }</span>
 172 |     | <span class='neutral'></span>
 173 |     | <span class='neutral'>    function removeFunction(DiamondStorage storage ds, address _facetAddress, bytes4 _selector) internal {        </span>
 174 |     | <span class='neutral'>        require(_facetAddress != address(0), &quot;LibDiamondCut: Can&#39;t remove function that doesn&#39;t exist&quot;);</span>
 175 |     | <span class='neutral'>        // an immutable function is a function defined directly in a diamond</span>
 176 |     | <span class='neutral'>        require(_facetAddress != address(this), &quot;LibDiamondCut: Can&#39;t remove immutable function&quot;);</span>
 177 |     | <span class='neutral'>        // replace selector with last selector, then delete last selector</span>
 178 |     | <span class='neutral'>        uint256 selectorPosition = ds.selectorToFacetAndPosition[_selector].functionSelectorPosition;</span>
 179 |     | <span class='neutral'>        uint256 lastSelectorPosition = ds.facetFunctionSelectors[_facetAddress].functionSelectors.length - 1;</span>
 180 |     | <span class='neutral'>        // if not the same then replace _selector with lastSelector</span>
 181 |     | <span class='neutral'>        if (selectorPosition != lastSelectorPosition) {</span>
 182 |     | <span class='neutral'>            bytes4 lastSelector = ds.facetFunctionSelectors[_facetAddress].functionSelectors[lastSelectorPosition];</span>
 183 |     | <span class='neutral'>            ds.facetFunctionSelectors[_facetAddress].functionSelectors[selectorPosition] = lastSelector;</span>
 184 |     | <span class='neutral'>            ds.selectorToFacetAndPosition[lastSelector].functionSelectorPosition = uint96(selectorPosition);</span>
 185 |     | <span class='neutral'>        }</span>
 186 |     | <span class='neutral'>        // delete the last selector</span>
 187 |     | <span class='neutral'>        ds.facetFunctionSelectors[_facetAddress].functionSelectors.pop();</span>
 188 |     | <span class='neutral'>        delete ds.selectorToFacetAndPosition[_selector];</span>
 189 |     | <span class='neutral'></span>
 190 |     | <span class='neutral'>        // if no more selectors for facet address then delete the facet address</span>
 191 |     | <span class='neutral'>        if (lastSelectorPosition == 0) {</span>
 192 |     | <span class='neutral'>            // replace facet address with last facet address and delete last facet address</span>
 193 |     | <span class='neutral'>            uint256 lastFacetAddressPosition = ds.facetAddresses.length - 1;</span>
 194 |     | <span class='neutral'>            uint256 facetAddressPosition = ds.facetFunctionSelectors[_facetAddress].facetAddressPosition;</span>
 195 |     | <span class='neutral'>            if (facetAddressPosition != lastFacetAddressPosition) {</span>
 196 |     | <span class='neutral'>                address lastFacetAddress = ds.facetAddresses[lastFacetAddressPosition];</span>
 197 |     | <span class='neutral'>                ds.facetAddresses[facetAddressPosition] = lastFacetAddress;</span>
 198 |     | <span class='neutral'>                ds.facetFunctionSelectors[lastFacetAddress].facetAddressPosition = facetAddressPosition;</span>
 199 |     | <span class='neutral'>            }</span>
 200 |     | <span class='neutral'>            ds.facetAddresses.pop();</span>
 201 |     | <span class='neutral'>            delete ds.facetFunctionSelectors[_facetAddress].facetAddressPosition;</span>
 202 |     | <span class='neutral'>        }</span>
 203 |     | <span class='neutral'>    }</span>
 204 |     | <span class='neutral'></span>
 205 |     | <span class='neutral'>    function initializeDiamondCut(address _init, bytes memory _calldata) internal {</span>
 206 |     | <span class='neutral'>        if (_init == address(0)) {</span>
 207 |     | <span class='neutral'>            require(_calldata.length == 0, &quot;LibDiamondCut: _init is address(0) but_calldata is not empty&quot;);</span>
 208 |     | <span class='neutral'>        } else {</span>
 209 |     | <span class='neutral'>            require(_calldata.length &gt; 0, &quot;LibDiamondCut: _calldata is empty but _init is not address(0)&quot;);</span>
 210 |     | <span class='neutral'>            if (_init != address(this)) {</span>
 211 |     | <span class='neutral'>                enforceHasContractCode(_init, &quot;LibDiamondCut: _init address has no code&quot;);</span>
 212 |     | <span class='neutral'>            }</span>
 213 |     | <span class='neutral'>            (bool success, bytes memory error) = _init.delegatecall(_calldata);</span>
 214 |     | <span class='neutral'>            if (!success) {</span>
 215 |     | <span class='neutral'>                if (error.length &gt; 0) {</span>
 216 |     | <span class='neutral'>                    // bubble up the error</span>
 217 |     | <span class='neutral'>                    revert(string(error));</span>
 218 |     | <span class='neutral'>                } else {</span>
 219 |     | <span class='neutral'>                    revert(&quot;LibDiamondCut: _init function reverted&quot;);</span>
 220 |     | <span class='neutral'>                }</span>
 221 |     | <span class='neutral'>            }</span>
 222 |     | <span class='neutral'>        }</span>
 223 |     | <span class='neutral'>    }</span>
 224 |     | <span class='neutral'></span>
 225 |     | <span class='neutral'>    function enforceHasContractCode(address _contract, string memory _errorMessage) internal view {</span>
 226 |     | <span class='neutral'>        uint256 contractSize;</span>
 227 |     | <span class='neutral'>        assembly {</span>
 228 |     | <span class='neutral'>            contractSize := extcodesize(_contract)</span>
 229 |     | <span class='neutral'>        }</span>
 230 |     | <span class='neutral'>        require(contractSize &gt; 0, _errorMessage);</span>
 231 |     | <span class='neutral'>    }</span>
 232 |     | <span class='neutral'></span>
 233 |     | <span class='neutral'>    /*///////////////////////////////////////////////////////////////</span>
 234 |     | <span class='neutral'>                               Custom methods</span>
 235 |     | <span class='neutral'>    //////////////////////////////////////////////////////////////*/</span>
 236 |     | <span class='neutral'></span>
 237 |     | <span class='neutral'>    /**</span>
 238 |     | <span class='neutral'>     * @dev Determines which facet to call depending on the selector</span>
 239 |     | <span class='neutral'>     * @param data_ Calldata of function to call</span>
 240 |     | <span class='neutral'>     * @return bytes Return data</span>
 241 |     | <span class='neutral'>     */</span>
 242 |     | <span class='neutral'>    function callFacet(bytes memory data_) internal returns(bytes memory) {</span>
 243 |     | <span class='neutral'>        DiamondStorage storage ds = diamondStorage();</span>
 244 |     | <span class='neutral'>        address facet = ds.selectorToFacetAndPosition[bytes4(data_)].facetAddress;</span>
 245 |     | <span class='neutral'>        (bool success, bytes memory data) = facet.delegatecall(data_);</span>
 246 |     | <span class='neutral'>        require(success, &#39;LibDiamond: callFacet() failed&#39;);</span>
 247 |     | <span class='neutral'>        return data;</span>
 248 |     | <span class='neutral'>    }</span>
 249 |     | <span class='neutral'></span>
 250 |     | <span class='neutral'>    /**</span>
 251 |     | <span class='neutral'>     * @dev Sets the facets that don&#39;t call for a revenue check (the owner&#39;s)</span>
 252 |     | <span class='neutral'>     * @param nonRevenueFacets_ Facets that don&#39;t call for revenue check</span>
 253 |     | <span class='neutral'>     */</span>
 254 |     | <span class='neutral'>    function setNonRevenueFacets(address[] memory nonRevenueFacets_) internal {</span>
 255 |     | <span class='neutral'>        DiamondStorage storage ds = diamondStorage();</span>
 256 |     | <span class='neutral'>        uint length = nonRevenueFacets_.length;</span>
 257 |     | <span class='neutral'>        for (uint i=0; i &lt; length;) {</span>
 258 |     | <span class='neutral'>            ds.nonRevenueFacets.push(nonRevenueFacets_[i]);</span>
 259 |     | <span class='neutral'>            unchecked { ++i; }</span>
 260 |     | <span class='neutral'>        }</span>
 261 |     | <span class='neutral'>    }</span>
 262 |     | <span class='neutral'>}</span>
 263 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/cdgmachado/Documents/Chainshot/myDapps/ozel-v2/test/echidna/EchidnaE2E.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: GPL-2.0-or-later</span>
  2 |     | <span class='neutral'>pragma solidity 0.8.19;</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'></span>
  5 |     | <span class='neutral'>import &#39;../../interfaces/ozIDiamond.sol&#39;;</span>
  6 |     | <span class='neutral'>import &#39;../../contracts/testing-files/WtiFeed.sol&#39;;</span>
  7 |     | <span class='neutral'>import &#39;../../contracts/testing-files/EthFeed.sol&#39;;</span>
  8 |     | <span class='neutral'>import &#39;../../contracts/testing-files/GoldFeed.sol&#39;;</span>
  9 |     | <span class='neutral'>import &#39;../../contracts/facets/ozOracleFacet.sol&#39;;</span>
 10 |     | <span class='neutral'>import &#39;../../contracts/InitUpgradeV2.sol&#39;;</span>
 11 |     | <span class='neutral'></span>
 12 | *r  | <span class='executed'></span>
 13 |     | <span class='neutral'>contract EchidnaE2E {</span>
 14 |     | <span class='neutral'></span>
 15 |     | <span class='neutral'>    ozIDiamond OZL;</span>
 16 |     | <span class='neutral'></span>
 17 |     | <span class='neutral'>    WtiFeed private wtiFeed;</span>
 18 |     | <span class='neutral'>    EthFeed private ethFeed;</span>
 19 |     | <span class='neutral'>    GoldFeed private goldFeed;</span>
 20 |     | <span class='neutral'></span>
 21 |     | <span class='neutral'>    ozOracleFacet private ozOracle;</span>
 22 |     | <span class='neutral'>    InitUpgradeV2 private initUpgrade;</span>
 23 |     | <span class='neutral'></span>
 24 |     | <span class='unexecuted'>    address private volIndex = 0xbcD8bEA7831f392bb019ef3a672CC15866004536;</span>
 25 |     | <span class='neutral'>    </span>
 26 |     | <span class='unexecuted'>    constructor() {</span>
 27 |     | <span class='unexecuted'>        OZL = ozIDiamond(0x7D1f13Dd05E6b0673DC3D0BFa14d40A74Cfa3EF2);</span>
 28 |     | <span class='neutral'></span>
 29 |     | <span class='unexecuted'>        ethFeed = new EthFeed();</span>
 30 |     | <span class='unexecuted'>        goldFeed = new GoldFeed();</span>
 31 |     | <span class='unexecuted'>        wtiFeed = new WtiFeed();</span>
 32 |     | <span class='neutral'></span>
 33 |     | <span class='unexecuted'>        ozOracle = new ozOracleFacet(); </span>
 34 |     | <span class='neutral'></span>
 35 |     | <span class='unexecuted'>        address[] memory facets = new address[](1);</span>
 36 |     | <span class='unexecuted'>        facets[0] = address(ozOracle);</span>
 37 |     | <span class='neutral'></span>
 38 |     | <span class='unexecuted'>        address[] memory feeds = new address[](4);</span>
 39 |     | <span class='unexecuted'>        feeds[0] = address(wtiFeed);</span>
 40 |     | <span class='unexecuted'>        feeds[1] = volIndex;</span>
 41 |     | <span class='unexecuted'>        feeds[2] = address(ethFeed);</span>
 42 |     | <span class='unexecuted'>        feeds[3] = address(goldFeed); </span>
 43 |     | <span class='neutral'></span>
 44 |     | <span class='unexecuted'>        initUpgrade = new InitUpgradeV2();</span>
 45 |     | <span class='neutral'></span>
 46 |     | <span class='unexecuted'>        bytes memory data = abi.encodeWithSelector(</span>
 47 |     | <span class='unexecuted'>            initUpgrade.init.selector,</span>
 48 |     | <span class='unexecuted'>            feeds,</span>
 49 |     | <span class='unexecuted'>            facets</span>
 50 |     | <span class='neutral'>        );</span>
 51 |     | <span class='neutral'></span>
 52 |     | <span class='unexecuted'>        bytes4[] memory selecOracle = new bytes4[](1);</span>
 53 |     | <span class='unexecuted'>        selecOracle[0] = bytes4(ozOracle.getLastPrice.selector);</span>
 54 |     | <span class='neutral'></span>
 55 |     | <span class='unexecuted'>        ozIDiamond.FacetCut memory cut = ozIDiamond.FacetCut({</span>
 56 |     | <span class='unexecuted'>            facetAddress: address(ozOracle),</span>
 57 |     | <span class='unexecuted'>            action: ozIDiamond.FacetCutAction.Add,</span>
 58 |     | <span class='unexecuted'>            functionSelectors: selecOracle</span>
 59 |     | <span class='neutral'>        });</span>
 60 |     | <span class='neutral'></span>
 61 |     | <span class='unexecuted'>        ozIDiamond.FacetCut[] memory cuts = new ozIDiamond.FacetCut[](2);</span>
 62 |     | <span class='unexecuted'>        cuts[0] = cut;</span>
 63 |     | <span class='neutral'></span>
 64 |     | <span class='neutral'>        // OZL.diamondCut(cuts, address(initUpgrade), data);</span>
 65 |     | <span class='neutral'>    }</span>
 66 |     | <span class='neutral'></span>
 67 |     | <span class='neutral'></span>
 68 |     | <span class='neutral'>    // function get_price() public view  {</span>
 69 |     | <span class='neutral'>    //     uint256 price = OZL.getLastPrice();</span>
 70 |     | <span class='neutral'>    //     // uint256 price = OZL.getOzelIndex();</span>
 71 |     | <span class='neutral'></span>
 72 |     | <span class='neutral'>    //     // bytes memory data = abi.encodeWithSig</span>
 73 |     | <span class='neutral'>    //     // (bool success,) = address(OZL).call();</span>
 74 |     | <span class='neutral'></span>
 75 |     | <span class='neutral'>    //     assert(price &gt; 0);</span>
 76 |     | <span class='neutral'>    // }</span>
 77 |     | <span class='neutral'></span>
 78 |     | <span class='neutral'>    // function get_round_data() public view  {</span>
 79 |     | <span class='neutral'>    //     (, int price,,,) = wtiFeed.latestRoundData();</span>
 80 |     | <span class='neutral'>    //     assert(price &gt; 0);</span>
 81 |     | <span class='neutral'>    // }</span>
 82 |     | <span class='neutral'></span>
 83 | *   | <span class='executed'>    function getHello() public pure {</span>
 84 | *   | <span class='executed'>        assert(true);</span>
 85 |     | <span class='neutral'>    }</span>
 86 |     | <span class='neutral'></span>
 87 |     | <span class='neutral'>}</span>

</code>
<br />

